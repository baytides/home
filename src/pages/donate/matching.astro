---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';

const structuredData = [
  {
    '@context': 'https://schema.org',
    '@type': 'WebPage',
    name: 'Double Your Donation - Corporate Matching Gifts',
    description:
      'Find out if your employer will match your donation to Bay Tides and double your impact.',
    url: 'https://baytides.org/donate/matching',
    isPartOf: {
      '@type': 'WebSite',
      name: 'Bay Tides',
      url: 'https://baytides.org',
    },
  },
  {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: [
      { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://baytides.org/' },
      { '@type': 'ListItem', position: 2, name: 'Donate', item: 'https://baytides.org/donate' },
      { '@type': 'ListItem', position: 3, name: 'Matching Gifts' },
    ],
  },
];
---

<BaseLayout
  title="Double Your Donation"
  description="Many employers match charitable donations. Use our matching gift tool to find out if your company will double your gift to Bay Tides."
  canonicalUrl="https://baytides.org/donate/matching"
  structuredData={structuredData}
>
  <Breadcrumb
    items={[
      { label: 'Home', href: '/' },
      { label: 'Donate', href: '/donate' },
      { label: 'Matching Gifts' },
    ]}
  />

  <section class="hero hero-page">
    <div class="container">
      <h1>Double Your Donation</h1>
      <p>Many employers match charitable contributions, doubling or even tripling your impact</p>
    </div>
  </section>

  <section class="content-section">
    <div class="container">
      <div class="matching-content">
        <div class="matching-intro">
          <h2>Does Your Employer Match Gifts?</h2>
          <p>
            Thousands of companies offer matching gift programs that can multiply your donation to
            Bay Tides. Use the search tool below to find out if your employer participates.
          </p>
          <p>
            Corporate matching gifts are one of the easiest ways to increase your charitable impact.
            Some companies match donations dollar-for-dollar, while others may double or even triple
            your contribution.
          </p>
        </div>

        <div class="matching-widget">
          <div class="matching-search-container">
            <label for="employer-search" class="search-label">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.3-4.3"></path>
              </svg>
              Search for your employer
            </label>
            <div class="search-input-wrapper">
              <input
                type="text"
                id="employer-search"
                placeholder="Enter your company name..."
                autocomplete="off"
              />
              <button type="button" id="search-btn" class="btn btn-primary">Search</button>
            </div>
            <div id="search-results" class="search-results" aria-live="polite"></div>
          </div>
        </div>

        <div class="matching-info">
          <h3>How It Works</h3>
          <ol role="list">
            <li>
              <strong>Search for your employer</strong> using the tool above to see if they offer a matching
              gift program.
            </li>
            <li>
              <strong>Make your donation</strong> to Bay Tides through our{' '}
              <a href="/donate">donation page</a>.
            </li>
            <li>
              <strong>Submit a matching request</strong> through your employer's giving portal or HR department.
            </li>
            <li>
              <strong>Your employer matches</strong> your gift, doubling your impact for the Bay.
            </li>
          </ol>
        </div>

        <div class="matching-help">
          <h3>Need Help?</h3>
          <p>
            If you have questions about matching gifts or need documentation for your employer's
            program, please <a href="/contact">contact us</a>. We're happy to provide any
            information needed to complete your matching gift request.
          </p>
          <p>
            <strong>Bay Tides EIN:</strong> 93-3889081
          </p>
        </div>

        <div class="matching-cta">
          <a href="/checkout" class="btn btn-primary btn-large">Donate Now</a>
          <p>Then check if your employer will match your gift</p>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script is:inline>
  (function () {
    const API_KEY = '13qDoFLXlus5V13X';
    const searchInput = document.getElementById('employer-search');
    const searchBtn = document.getElementById('search-btn');
    const resultsContainer = document.getElementById('search-results');

    let debounceTimer;

    function clearResults() {
      while (resultsContainer.firstChild) {
        resultsContainer.removeChild(resultsContainer.firstChild);
      }
    }

    function createLoadingState() {
      clearResults();
      const loading = document.createElement('div');
      loading.className = 'search-loading';
      loading.textContent = 'Searching...';
      resultsContainer.appendChild(loading);
    }

    function createNoResults(query) {
      clearResults();
      const noResults = document.createElement('div');
      noResults.className = 'no-results';

      const icon = document.createElement('div');
      icon.className = 'no-results-icon';
      icon.textContent = '?';
      noResults.appendChild(icon);

      const text = document.createElement('p');
      text.textContent = 'No matching companies found for "' + query + '"';
      noResults.appendChild(text);

      const hint = document.createElement('p');
      hint.className = 'no-results-hint';
      hint.textContent = 'Try a different spelling or search for your parent company';
      noResults.appendChild(hint);

      resultsContainer.appendChild(noResults);
    }

    function createErrorState() {
      clearResults();
      const error = document.createElement('div');
      error.className = 'search-error';
      error.textContent = 'Unable to search at this time. Please try again later.';
      resultsContainer.appendChild(error);
    }

    function createCompanyResult(company) {
      const hasMatching =
        company.matching_gift_offered === true || company.matching_gift_offered === 'true';

      const result = document.createElement('div');
      result.className = 'company-result';

      const info = document.createElement('div');
      info.className = 'company-info';

      const name = document.createElement('span');
      name.className = 'company-name';
      name.textContent = company.company_name;
      info.appendChild(name);

      const status = document.createElement('span');
      status.className = 'company-status ' + (hasMatching ? 'status-yes' : 'status-maybe');
      status.textContent = hasMatching ? 'Matching Available' : 'Check with HR';
      info.appendChild(status);

      result.appendChild(info);

      if (company.matching_gift_url) {
        const link = document.createElement('a');
        link.href = company.matching_gift_url;
        link.target = '_blank';
        link.rel = 'noopener';
        link.className = 'btn btn-outline btn-small';
        link.textContent = 'View Details';
        result.appendChild(link);
      } else {
        const contactHr = document.createElement('span');
        contactHr.className = 'contact-hr';
        contactHr.textContent = 'Contact your HR department';
        result.appendChild(contactHr);
      }

      return result;
    }

    function displayResults(companies) {
      clearResults();

      const header = document.createElement('div');
      header.className = 'results-header';
      const count = companies.length > 10 ? '10+' : companies.length;
      header.textContent = count + ' ' + (companies.length === 1 ? 'result' : 'results') + ' found';
      resultsContainer.appendChild(header);

      companies.slice(0, 10).forEach(function (company) {
        resultsContainer.appendChild(createCompanyResult(company));
      });
    }

    function searchEmployers(query) {
      if (!query || query.length < 2) {
        clearResults();
        return;
      }

      createLoadingState();

      fetch(
        'https://doublethedonation.com/api/360matchpro/v1/search/?query=' +
          encodeURIComponent(query) +
          '&key=' +
          API_KEY
      )
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          if (data.companies && data.companies.length > 0) {
            displayResults(data.companies);
          } else {
            createNoResults(query);
          }
        })
        .catch(function (error) {
          console.error('Search error:', error);
          createErrorState();
        });
    }

    // Event listeners
    searchInput.addEventListener('input', function () {
      clearTimeout(debounceTimer);
      var value = this.value.trim();
      debounceTimer = setTimeout(function () {
        searchEmployers(value);
      }, 300);
    });

    searchInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        clearTimeout(debounceTimer);
        searchEmployers(this.value.trim());
      }
    });

    searchBtn.addEventListener('click', function () {
      clearTimeout(debounceTimer);
      searchEmployers(searchInput.value.trim());
    });
  })();
</script>

<style>
  .matching-content {
    max-width: 800px;
    margin: 0 auto;
  }

  .matching-intro {
    margin-bottom: 3rem;
    text-align: center;
  }

  .matching-intro h2 {
    margin-bottom: 1.5rem;
  }

  .matching-intro p {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--text-light);
    margin-bottom: 1rem;
  }

  .matching-widget {
    background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 16px;
    padding: 2.5rem;
    margin-bottom: 3rem;
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.05),
      0 10px 30px -5px rgba(0, 0, 0, 0.08),
      0 0 0 1px rgba(0, 0, 0, 0.03);
    border-top: 4px solid var(--primary-blue);
  }

  /* Custom Search Widget Styles */
  .matching-search-container {
    max-width: 600px;
    margin: 0 auto;
  }

  .search-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary-navy);
    margin-bottom: 1rem;
  }

  .search-label svg {
    flex-shrink: 0;
    color: var(--primary-blue);
  }

  .search-input-wrapper {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .search-input-wrapper input {
    flex: 1;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    background: #fff;
    color: var(--text-dark);
    transition:
      border-color 0.2s ease,
      box-shadow 0.2s ease;
    -webkit-appearance: none;
    appearance: none;
  }

  .search-input-wrapper input:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.15);
  }

  .search-input-wrapper input::placeholder {
    color: #a0aec0;
  }

  .search-input-wrapper .btn {
    flex-shrink: 0;
    padding: 1rem 1.5rem;
  }

  /* Search Results */
  .search-results {
    min-height: 0;
  }

  .results-header {
    font-size: 0.875rem;
    color: var(--text-light);
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid #e2e8f0;
  }

  .company-result {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 1.25rem;
    margin-bottom: 0.75rem;
    background: var(--light-blue, #f0f7ff);
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    transition: all 0.2s ease;
  }

  .company-result:hover {
    border-color: var(--primary-blue);
    box-shadow: 0 4px 12px rgba(43, 108, 176, 0.1);
    transform: translateY(-2px);
  }

  .company-info {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    min-width: 0;
  }

  .company-name {
    font-weight: 600;
    color: var(--primary-navy);
    font-size: 1rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .company-status {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.8125rem;
    font-weight: 500;
    padding: 0.25rem 0.625rem;
    border-radius: 20px;
    width: fit-content;
  }

  .company-status.status-yes {
    background: #c6f6d5;
    color: #22543d;
  }

  .company-status.status-maybe {
    background: #fef3c7;
    color: #92400e;
  }

  .btn-outline.btn-small {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    border: 2px solid var(--primary-navy);
    background: transparent;
    color: var(--primary-navy);
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    white-space: nowrap;
    transition: all 0.2s ease;
  }

  .btn-outline.btn-small:hover {
    background: var(--primary-navy);
    color: #fff;
  }

  .contact-hr {
    font-size: 0.875rem;
    color: var(--text-light);
    white-space: nowrap;
  }

  /* Loading State */
  .search-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 2rem;
    color: var(--text-light);
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* No Results State */
  .no-results {
    text-align: center;
    padding: 2.5rem 1rem;
  }

  .no-results-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 1rem;
    background: var(--light-blue, #f0f7ff);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: var(--text-light);
  }

  .no-results p {
    color: var(--text-dark);
    margin-bottom: 0.5rem;
  }

  .no-results-hint {
    font-size: 0.875rem;
    color: var(--text-light);
  }

  /* Error State */
  .search-error {
    text-align: center;
    padding: 2rem;
    background: #fed7d7;
    border-radius: 12px;
    color: #c53030;
  }

  /* Mobile Responsive */
  @media (max-width: 600px) {
    .matching-widget {
      padding: 1.5rem;
    }

    .search-label {
      font-size: 1rem;
    }

    .search-input-wrapper {
      flex-direction: column;
    }

    .search-input-wrapper .btn {
      width: 100%;
    }

    .company-result {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .company-info {
      width: 100%;
    }

    .company-name {
      white-space: normal;
    }

    .btn-outline.btn-small {
      width: 100%;
      text-align: center;
    }
  }

  .matching-info {
    margin-bottom: 3rem;
  }

  .matching-info h3 {
    margin-bottom: 1.5rem;
    color: var(--primary-navy);
  }

  .matching-info ol {
    list-style: none;
    padding: 0;
    counter-reset: steps;
  }

  .matching-info li {
    counter-increment: steps;
    padding: 1rem 0 1rem 3.5rem;
    position: relative;
    border-bottom: 1px solid var(--border-color, #e2e8f0);
  }

  .matching-info li:last-child {
    border-bottom: none;
  }

  .matching-info li::before {
    content: counter(steps);
    position: absolute;
    left: 0;
    top: 1rem;
    width: 2rem;
    height: 2rem;
    background: var(--primary-navy);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.875rem;
  }

  /* Ensure screen readers announce the list properly */
  .matching-info ol[role='list'] {
    list-style: none;
  }

  .matching-help {
    background: var(--cream);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 3rem;
  }

  .matching-help h3 {
    margin-bottom: 1rem;
    color: var(--primary-navy);
  }

  .matching-help p {
    margin-bottom: 0.75rem;
  }

  .matching-help p:last-child {
    margin-bottom: 0;
  }

  .matching-cta {
    text-align: center;
    padding: 2rem 0;
  }

  .matching-cta p {
    margin-top: 1rem;
    color: var(--text-light);
    font-size: 0.9375rem;
  }
</style>
