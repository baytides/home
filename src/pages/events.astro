---
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import PageHero from '../components/PageHero.astro';
import Card from '../components/Card.astro';

const structuredData = [
  {
    '@context': 'https://schema.org',
    '@type': 'CollectionPage',
    name: 'Bay Tides Events',
    description: 'Upcoming volunteer events, workshops, and community gatherings',
    publisher: {
      '@type': 'NonprofitOrganization',
      name: 'Bay Tides',
      url: 'https://baytides.org',
    },
  },
  {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: [
      { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://baytides.org/' },
      { '@type': 'ListItem', position: 2, name: 'Events' },
    ],
  },
];

// EventSchedule embed URL - uses /c/[name] pattern for calendars
// seamless=true removes the app background for cleaner embedding
const eventScheduleUrl = 'https://events.baytides.org/c/calendar?embed=true&seamless=true';
---

<BaseLayout
  title="Events"
  description="Join Bay Tides at our upcoming volunteer events, workshops, and community gatherings. Find opportunities to help protect the San Francisco Bay."
  canonicalUrl="https://baytides.org/events"
  structuredData={structuredData}
  preloadImages={['/assets/images/hero-bg.webp']}
>
  <Breadcrumb items={[{ label: 'Home', href: '/' }, { label: 'Events' }]} />

  <PageHero title="Upcoming Events" subtitle="Join us in protecting the San Francisco Bay" />

  <!-- Events Calendar -->
  <section class="content-section">
    <div class="container">
      <div class="section-title">
        <h2>Event Calendar</h2>
        <p>Find volunteer opportunities and community events near you</p>
      </div>

      <div class="calendar-embed" id="calendar-container">
        <div class="calendar-wrapper">
          <iframe
            src={eventScheduleUrl}
            title="Bay Tides Events Calendar"
            loading="lazy"
            allowfullscreen
          >
          </iframe>
        </div>
        <noscript>
          <p class="calendar-fallback">
            <a href="https://events.baytides.org" target="_blank" rel="noopener noreferrer">
              View our event calendar at events.baytides.org
            </a>
          </p>
        </noscript>
      </div>
    </div>
  </section>

  <!-- Newsletter & Updates -->
  <section class="content-section">
    <div class="container">
      <div class="content-centered">
        <h2>Stay Updated</h2>
        <p>
          Want to be the first to know about new events? Subscribe to our newsletter for event
          announcements, volunteer opportunities, and conservation news.
        </p>
        <a href="/contact" class="btn btn-primary">Subscribe to Newsletter</a>
      </div>
    </div>
  </section>

  <!-- Host an Event -->
  <section class="content-section alt-bg">
    <div class="container">
      <div class="content-centered">
        <h2>Host a Cleanup or Workshop</h2>
        <p>
          Interested in organizing a cleanup event in your neighborhood or hosting an educational
          workshop? We'd love to partner with you! Contact us to discuss how we can support your
          community-led conservation efforts.
        </p>
        <a href="/contact" class="btn btn-secondary">Contact Us</a>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .calendar-embed {
    margin: 1rem 0 0 0;
    overflow: hidden;
  }

  .calendar-wrapper {
    position: relative;
    padding-bottom: 75%;
    height: 0;
    overflow: hidden;
    min-height: 600px;
  }

  @media (min-width: 768px) {
    .calendar-wrapper {
      padding-bottom: 56.25%;
      min-height: 700px;
    }
  }

  .calendar-wrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }

  .calendar-fallback {
    padding: 2rem;
    text-align: center;
    color: var(--body-text);
  }
</style>

<script>
  // Handle iframe theme sync with page theme
  function updateCalendarTheme() {
    const iframe = document.querySelector('.calendar-wrapper iframe') as HTMLIFrameElement;
    if (iframe) {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      const currentSrc = iframe.src;
      const url = new URL(currentSrc);
      url.searchParams.set('theme', isDark ? 'dark' : 'light');

      // Only update if theme changed
      if (iframe.src !== url.toString()) {
        iframe.src = url.toString();
      }
    }
  }

  // Watch for theme changes
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'data-theme') {
        updateCalendarTheme();
      }
    });
  });

  observer.observe(document.documentElement, { attributes: true });

  // Initial theme sync
  document.addEventListener('DOMContentLoaded', updateCalendarTheme);
</script>
