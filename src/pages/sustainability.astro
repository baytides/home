---
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import PageHero from '../components/PageHero.astro';

const structuredData = [
  {
    '@context': 'https://schema.org',
    '@type': 'WebPage',
    name: 'Sustainability',
    description:
      "Bay Tides' commitment to sustainable digital practices and environmental responsibility",
    publisher: {
      '@type': 'NonprofitOrganization',
      name: 'Bay Tides',
      url: 'https://baytides.org',
    },
  },
  {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: [
      { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://baytides.org/' },
      { '@type': 'ListItem', position: 2, name: 'Sustainability' },
    ],
  },
];

// Green tech stack features
const greenTechStack = [
  {
    name: 'Static Site Generation',
    description:
      'Pre-built HTML pages eliminate server-side processing, reducing energy consumption by up to 90% compared to traditional dynamic sites.',
    icon: 'static',
    impact: 'High',
  },
  {
    name: 'Edge Caching via Cloudflare',
    description:
      'Content served from edge locations worldwide minimizes data travel distance and reduces network energy usage.',
    icon: 'edge',
    impact: 'High',
  },
  {
    name: 'Optimized Assets',
    description:
      'WebP images, minimal JavaScript, and compressed resources reduce bandwidth and energy required for page loads.',
    icon: 'optimize',
    impact: 'Medium',
  },
  {
    name: 'Dark Mode Support',
    description:
      'OLED-friendly dark theme reduces display energy consumption by up to 60% on compatible devices.',
    icon: 'dark',
    impact: 'Medium',
  },
  {
    name: 'Lazy Loading',
    description:
      'Images and resources load only when needed, preventing unnecessary data transfer and processing.',
    icon: 'lazy',
    impact: 'Medium',
  },
  {
    name: 'Minimal Dependencies',
    description:
      'Lean codebase with zero framework bloat reduces build complexity and deployment energy.',
    icon: 'minimal',
    impact: 'Low',
  },
];

// Environmental practices
const environmentalPractices = [
  {
    title: 'Digital Carbon Awareness',
    description:
      'We design our digital experiences with carbon impact in mind, optimizing for efficiency at every layer of the stack.',
    items: [
      'Lightweight pages averaging under 500KB total weight',
      'Server-side rendering eliminates client-side processing',
      'Efficient image formats (WebP) with responsive sizing',
      'Minimal third-party scripts and trackers',
    ],
  },
  {
    title: 'Sustainable Infrastructure',
    description:
      'Our hosting and infrastructure choices prioritize renewable energy and energy efficiency.',
    items: [
      'Cloudflare runs on 100% renewable energy',
      'Azure data centers committed to carbon negative by 2030',
      'Edge computing reduces data center load',
      'Efficient DNS and CDN routing',
    ],
  },
  {
    title: 'Responsible Development',
    description:
      'Our development practices minimize waste and maximize efficiency throughout the software lifecycle.',
    items: [
      'CI/CD pipelines optimized to reduce build frequency',
      'Code reviews ensure efficiency before deployment',
      'Automated testing prevents wasteful debugging cycles',
      'Open source contributions reduce duplicate development',
    ],
  },
];

// Provider stats for display
const providerStats = {
  cloudflare: {
    renewableEnergy: 100,
    carbonReduction: 96,
    netZeroSince: 2025,
  },
  github: {
    carbonNeutralSince: 2019,
    waterPositiveBy: 2030,
  },
};
---

<BaseLayout
  title="Sustainability"
  description="Bay Tides' commitment to sustainable digital practices. Learn how we minimize our environmental impact through green technology choices."
  canonicalUrl="https://baytides.org/sustainability"
  structuredData={structuredData}
  preloadImages={['/assets/images/hero-bg.webp']}
>
  <Breadcrumb items={[{ label: 'Home', href: '/' }, { label: 'Sustainability' }]} />

  <PageHero
    title="Digital Sustainability"
    subtitle="Building a greener web for a healthier planet"
  />

  <!-- Live Carbon Dashboard -->
  <section class="content-section" aria-labelledby="dashboard-heading">
    <div class="container">
      <div class="carbon-dashboard">
        <div class="dashboard-header">
          <div class="dashboard-indicator" id="dashboard-indicator"></div>
          <h2 id="dashboard-heading">Carbon Dashboard</h2>
          <span class="dashboard-status" id="dashboard-status">Loading...</span>
        </div>
        <p class="dashboard-intro">
          Estimated environmental impact based on our Cloudflare and GitHub infrastructure.
          According to their published reports, all providers aim to use 100% renewable energy.
        </p>

        <!-- Usage Stats -->
        <div class="usage-grid" role="list" aria-label="Usage statistics">
          <div class="usage-card" role="listitem">
            <span class="usage-value" id="stat-cdn-requests">&mdash;</span>
            <span class="usage-label">CDN Requests</span>
          </div>
          <div class="usage-card" role="listitem">
            <span class="usage-value" id="stat-page-views">&mdash;</span>
            <span class="usage-label">Page Views</span>
          </div>
          <div class="usage-card" role="listitem">
            <span class="usage-value" id="stat-ci-runs">&mdash;</span>
            <span class="usage-label">CI/CD Runs</span>
          </div>
          <div class="usage-card" role="listitem">
            <span class="usage-value" id="stat-renewable">100%</span>
            <span class="usage-label">Renewable Energy</span>
          </div>
        </div>

        <!-- Carbon Summary -->
        <div class="carbon-summary">
          <div class="summary-card">
            <span class="summary-value" id="stat-gross">&mdash;</span>
            <span class="summary-label">Gross kg CO&#8322;e</span>
          </div>
          <div class="summary-card highlight">
            <span class="summary-value" id="stat-net">0</span>
            <span class="summary-label">Net kg CO&#8322;e</span>
          </div>
          <div class="summary-card">
            <span class="summary-value" id="stat-rating">A+</span>
            <span class="summary-label">Green Rating</span>
          </div>
        </div>

        <!-- Emissions Breakdown -->
        <div class="emissions-breakdown">
          <span class="breakdown-label">
            Emissions breakdown (grams CO&#8322;e, before renewable offset):
          </span>
          <div class="breakdown-items">
            <span class="breakdown-item" id="breakdown-cdn">CDN: &mdash;</span>
            <span class="breakdown-item" id="breakdown-hosting">Hosting: &mdash;</span>
            <span class="breakdown-item" id="breakdown-ci">CI/CD: &mdash;</span>
          </div>
        </div>

        <!-- Data Sources -->
        <div class="data-sources">
          <span class="source-badge" id="source-cloudflare">Cloudflare: &mdash;</span>
          <span class="source-badge" id="source-github">GitHub: &mdash;</span>
          <span class="source-badge" id="source-azure">Azure: &mdash;</span>
        </div>

        <!-- Equivalents -->
        <p class="equivalents-text" id="stat-equivalents">Loading real usage data...</p>
      </div>
    </div>
  </section>

  <!-- Our Commitment -->
  <section class="content-section alt-bg" aria-labelledby="commitment-heading">
    <div class="container">
      <div class="content-centered">
        <h2 id="commitment-heading">Our Commitment</h2>
        <p>
          As an environmental nonprofit, we believe our digital presence should reflect our values.
          The internet accounts for roughly 4% of global carbon emissions, and we're committed to
          minimizing our contribution through thoughtful technology choices.
        </p>
        <p>
          Every design decision, from image optimization to hosting selection, is made with
          environmental impact in mind. We practice what we preach: protecting the San Francisco Bay
          means protecting the entire planet.
        </p>
      </div>
    </div>
  </section>

  <!-- Green Tech Stack -->
  <section class="content-section" aria-labelledby="tech-heading">
    <div class="container">
      <div class="section-title">
        <h2 id="tech-heading">Green Technology Stack</h2>
        <p>Sustainable choices at every layer</p>
      </div>

      <div class="tech-grid" role="list" aria-label="Green technology features">
        {
          greenTechStack.map((tech) => (
            <article class="tech-card" role="listitem">
              <div class="tech-icon" aria-hidden="true">
                {tech.icon === 'static' && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4" />
                    <polyline points="14 2 14 8 20 8" />
                    <path d="m3 15 2 2 4-4" />
                  </svg>
                )}
                {tech.icon === 'edge' && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="12" cy="12" r="10" />
                    <line x1="2" y1="12" x2="22" y2="12" />
                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                  </svg>
                )}
                {tech.icon === 'optimize' && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                    <polyline points="7.5 4.21 12 6.81 16.5 4.21" />
                    <polyline points="7.5 19.79 7.5 14.6 3 12" />
                    <polyline points="21 12 16.5 14.6 16.5 19.79" />
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                    <line x1="12" y1="22.08" x2="12" y2="12" />
                  </svg>
                )}
                {tech.icon === 'dark' && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
                  </svg>
                )}
                {tech.icon === 'lazy' && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                    <circle cx="8.5" cy="8.5" r="1.5" />
                    <polyline points="21 15 16 10 5 21" />
                  </svg>
                )}
                {tech.icon === 'minimal' && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polyline points="16 18 22 12 16 6" />
                    <polyline points="8 6 2 12 8 18" />
                  </svg>
                )}
              </div>
              <div class="tech-content">
                <h3>{tech.name}</h3>
                <p>{tech.description}</p>
              </div>
              <span class={`impact-badge ${tech.impact.toLowerCase()}`}>{tech.impact} Impact</span>
            </article>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Environmental Practices -->
  <section class="content-section alt-bg" aria-labelledby="practices-heading">
    <div class="container">
      <div class="section-title">
        <h2 id="practices-heading">Our Practices</h2>
        <p>How we minimize our digital carbon footprint</p>
      </div>

      <div class="practices-grid" role="list" aria-label="Environmental practices">
        {
          environmentalPractices.map((practice) => (
            <article class="practice-card" role="listitem">
              <h3>{practice.title}</h3>
              <p class="practice-desc">{practice.description}</p>
              <ul class="practice-list">
                {practice.items.map((item) => (
                  <li>
                    <span class="check-icon" aria-hidden="true">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <polyline points="20 6 9 17 4 12" />
                      </svg>
                    </span>
                    {item}
                  </li>
                ))}
              </ul>
            </article>
          ))
        }
      </div>
    </div>
  </section>

  <!-- How You Can Help -->
  <section class="content-section" aria-labelledby="help-heading">
    <div class="container">
      <div class="section-title">
        <h2 id="help-heading">How You Can Help</h2>
        <p>Small actions make a big difference</p>
      </div>

      <div class="tips-content">
        <div class="tips-grid" role="list" aria-label="Sustainability tips for users">
          <div class="tip-card" role="listitem">
            <div class="tip-number" aria-hidden="true">1</div>
            <h3>Enable Dark Mode</h3>
            <p>
              Use our dark theme to reduce display energy consumption, especially on OLED screens.
            </p>
            <button
              type="button"
              class="tip-action"
              id="dark-mode-toggle"
              aria-pressed="false"
              aria-label="Toggle dark mode"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
              </svg>
              <span id="dark-mode-label">Enable Dark Mode</span>
            </button>
          </div>

          <div class="tip-card" role="listitem">
            <div class="tip-number" aria-hidden="true">2</div>
            <h3>Bookmark This Page</h3>
            <p>
              Bookmark frequently visited pages to reduce search engine queries and associated
              energy usage.
            </p>
            <button
              type="button"
              class="tip-action"
              id="bookmark-btn"
              aria-label="Bookmark this page"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"></path>
              </svg>
              <span>Add Bookmark</span>
              <kbd class="kbd-hint">⌘D</kbd>
            </button>
          </div>

          <div class="tip-card" role="listitem">
            <div class="tip-number" aria-hidden="true">3</div>
            <h3>Close Unused Tabs</h3>
            <p>Each open tab consumes memory and energy. Close tabs you're not actively using.</p>
            <span class="tip-info">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 16v-4"></path>
                <path d="M12 8h.01"></path>
              </svg>
              <span>Use <kbd class="kbd-hint">⌘W</kbd> to close tabs</span>
            </span>
          </div>

          <div class="tip-card" role="listitem">
            <div class="tip-number" aria-hidden="true">4</div>
            <h3>Use Wi-Fi Over Cellular</h3>
            <p>Wi-Fi connections use significantly less energy than cellular data.</p>
            <span class="tip-info">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <path d="M5 13a10 10 0 0 1 14 0"></path>
                <path d="M8.5 16.5a5 5 0 0 1 7 0"></path>
                <path d="M2 8.82a15 15 0 0 1 20 0"></path>
                <line x1="12" x2="12.01" y1="20" y2="20"></line>
              </svg>
              <span>Check your device settings</span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Transparency -->
  <section class="content-section alt-bg" aria-labelledby="transparency-heading">
    <div class="container">
      <div class="content-centered">
        <h2 id="transparency-heading">Our Transparency</h2>
        <p>
          We're committed to honest reporting about our environmental impact. While we've optimized
          our digital presence, we acknowledge that every website has some carbon footprint.
        </p>
        <p>
          We regularly audit our site using tools like Website Carbon Calculator and Ecograder to
          identify improvement opportunities. Our goal is continuous improvement, not perfection.
        </p>
        <p>
          If you have suggestions for reducing our environmental impact, we'd love to hear from you.
        </p>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="impact" aria-labelledby="cta-heading">
    <div class="container">
      <div class="impact-content">
        <h2 id="cta-heading">Join Our Mission</h2>
        <p>
          Protecting the San Francisco Bay means protecting our entire planet. Every sustainable
          choice matters, from reducing plastic pollution to minimizing our digital carbon
          footprint.
        </p>
        <p class="highlight">Together, we can build a more sustainable future.</p>
        <div class="cta-buttons">
          <a href="/volunteer" class="btn btn-secondary">Volunteer With Us</a>
          <a href="/donate" class="btn btn-outline">Support Our Work</a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* Carbon Dashboard */
  .carbon-dashboard {
    max-width: 900px;
    margin: 0 auto;
    background: linear-gradient(135deg, rgba(34, 84, 61, 0.08) 0%, rgba(39, 103, 73, 0.08) 100%);
    border: 1px solid rgba(34, 84, 61, 0.2);
    border-radius: 16px;
    padding: 2rem;
  }

  .dashboard-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }

  .dashboard-indicator {
    width: 12px;
    height: 12px;
    background: var(--success);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }

  .dashboard-header h2 {
    font-size: 1.25rem;
    margin: 0;
    color: var(--text-dark);
  }

  .dashboard-status {
    font-size: 0.75rem;
    background: rgba(34, 84, 61, 0.15);
    color: var(--success);
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
  }

  .dashboard-status.live {
    background: rgba(34, 197, 94, 0.15);
    color: #16a34a;
  }

  .dashboard-status.estimated {
    background: rgba(59, 130, 246, 0.15);
    color: #2563eb;
  }

  .dashboard-status.offline {
    background: rgba(107, 114, 128, 0.15);
    color: var(--text-light);
  }

  .dashboard-intro {
    color: var(--text-light);
    font-size: 0.9375rem;
    margin-bottom: 1.5rem;
  }

  .usage-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .usage-card {
    background: var(--card-bg);
    padding: 1.25rem 1rem;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }

  .usage-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-blue);
    margin-bottom: 0.25rem;
  }

  .usage-card:nth-child(1) .usage-value {
    color: #3b82f6;
  }
  .usage-card:nth-child(2) .usage-value {
    color: #8b5cf6;
  }
  .usage-card:nth-child(3) .usage-value {
    color: #f97316;
  }
  .usage-card:nth-child(4) .usage-value {
    color: var(--success);
  }

  .usage-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-light);
  }

  .carbon-summary {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .summary-card {
    background: var(--card-bg);
    padding: 1rem;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }

  .summary-value {
    display: block;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-light);
    margin-bottom: 0.25rem;
  }

  .summary-card.highlight .summary-value {
    color: var(--success);
  }

  .summary-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-light);
  }

  .emissions-breakdown {
    padding: 1rem 0;
    border-top: 1px solid rgba(34, 84, 61, 0.15);
  }

  .breakdown-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-light);
    margin-bottom: 0.5rem;
  }

  .breakdown-items {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .breakdown-item {
    font-size: 0.75rem;
    background: var(--card-bg);
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    color: var(--text-light);
  }

  .data-sources {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.75rem;
  }

  .source-badge {
    font-size: 0.75rem;
    background: rgba(107, 114, 128, 0.15);
    color: var(--text-light);
    padding: 0.25rem 0.625rem;
    border-radius: 4px;
  }

  .source-badge.live {
    background: rgba(34, 197, 94, 0.15);
    color: #16a34a;
  }

  .source-badge.estimated {
    background: rgba(234, 179, 8, 0.15);
    color: #ca8a04;
  }

  .equivalents-text {
    font-size: 0.75rem;
    color: var(--text-light);
    margin: 0.75rem 0 0 0;
  }

  /* Tech Stack Grid */
  .tech-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
  }

  .tech-card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 1.75rem;
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: flex-start;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    position: relative;
    transition:
      transform 0.2s ease,
      box-shadow 0.2s ease;
  }

  .tech-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }

  .tech-icon {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    background: var(--light-blue);
    color: var(--primary-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .tech-content {
    flex: 1;
    min-width: 200px;
  }

  .tech-content h3 {
    color: var(--primary-navy);
    font-size: 1.125rem;
    margin-bottom: 0.5rem;
  }

  .tech-content p {
    color: var(--text-light);
    font-size: 0.9375rem;
    line-height: 1.6;
    margin: 0;
  }

  .tech-card .impact-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 0.6875rem;
    font-weight: 600;
    padding: 0.25rem 0.625rem;
    border-radius: 9999px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: transparent;
    margin: 0;
    gap: 0;
  }

  .tech-card .impact-badge.high {
    background: rgba(34, 197, 94, 0.15);
    color: var(--success);
  }

  .tech-card .impact-badge.medium {
    background: rgba(59, 130, 246, 0.15);
    color: var(--primary-blue);
  }

  .tech-card .impact-badge.low {
    background: rgba(107, 114, 128, 0.15);
    color: var(--text-light);
  }

  /* Practices Grid */
  .practices-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .practice-card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .practice-card h3 {
    color: var(--primary-navy);
    font-size: 1.25rem;
    margin-bottom: 0.75rem;
  }

  .practice-desc {
    color: var(--text-light);
    font-size: 0.9375rem;
    margin-bottom: 1.25rem;
    line-height: 1.6;
  }

  .practice-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .practice-list li {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.5rem 0;
    color: var(--text-light);
    font-size: 0.9375rem;
  }

  .check-icon {
    flex-shrink: 0;
    color: var(--success);
    margin-top: 0.125rem;
  }

  /* Tips Grid */
  .tips-content {
    max-width: 900px;
    margin: 0 auto;
  }

  .tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
  }

  .tip-card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 1.75rem;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition:
      transform 0.2s ease,
      box-shadow 0.2s ease;
    display: flex;
    flex-direction: column;
  }

  .tip-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }

  .tip-number {
    width: 40px;
    height: 40px;
    margin: 0 auto 1rem;
    background: var(--success);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.25rem;
  }

  .tip-card h3 {
    color: var(--primary-navy);
    font-size: 1.0625rem;
    margin-bottom: 0.75rem;
  }

  .tip-card p {
    color: var(--text-light);
    font-size: 0.875rem;
    line-height: 1.6;
    margin: 0 0 1rem 0;
  }

  .tip-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.75rem 1rem;
    background: var(--success);
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    min-height: var(--min-touch-target);
    margin-top: auto;
  }

  .tip-action:hover {
    background: #16a34a;
    transform: translateY(-1px);
  }

  .tip-action:focus-visible {
    outline: 3px solid var(--success);
    outline-offset: 2px;
  }

  .tip-action:active {
    transform: translateY(0);
  }

  .tip-action[aria-pressed='true'] {
    background: var(--primary-blue);
  }

  .tip-action[aria-pressed='true']:hover {
    background: #2563eb;
  }

  .kbd-hint {
    display: inline-block;
    padding: 0.125rem 0.375rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    font-size: 0.75rem;
    font-family:
      system-ui,
      -apple-system,
      sans-serif;
    font-weight: 500;
  }

  .tip-info {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    background: rgba(107, 114, 128, 0.1);
    color: var(--text-light);
    border-radius: 8px;
    font-size: 0.8125rem;
    margin-top: auto;
  }

  .tip-info svg {
    flex-shrink: 0;
    opacity: 0.7;
  }

  .tip-info .kbd-hint {
    background: rgba(107, 114, 128, 0.15);
    color: var(--text-light);
  }

  /* CTA Buttons */
  .cta-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 1rem;
  }

  .btn-outline {
    background: transparent;
    border: 2px solid #fff;
    color: #fff;
    padding: 0.875rem 2rem;
    border-radius: 6px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
    min-height: var(--min-touch-target);
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .btn-outline:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .btn-outline:focus-visible {
    outline: 3px solid #fff;
    outline-offset: 2px;
  }

  /* Dark Theme */
  :global([data-theme='dark']) .carbon-dashboard {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, rgba(16, 185, 129, 0.08) 100%);
    border-color: rgba(34, 197, 94, 0.2);
  }

  :global([data-theme='dark']) .dashboard-header h2 {
    color: var(--text-dark);
  }

  :global([data-theme='dark']) .usage-card,
  :global([data-theme='dark']) .summary-card {
    background: var(--card-bg);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }

  :global([data-theme='dark']) .breakdown-item {
    background: var(--card-bg);
  }

  :global([data-theme='dark']) .emissions-breakdown {
    border-color: rgba(34, 197, 94, 0.15);
  }

  :global([data-theme='dark']) .tech-card {
    background: var(--card-bg);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  :global([data-theme='dark']) .tech-icon {
    background: rgba(163, 213, 255, 0.1);
  }

  :global([data-theme='dark']) .tech-content h3 {
    color: var(--text-dark);
  }

  :global([data-theme='dark']) .practice-card {
    background: var(--card-bg);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  :global([data-theme='dark']) .practice-card h3 {
    color: var(--text-dark);
  }

  :global([data-theme='dark']) .tip-card {
    background: var(--card-bg);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  :global([data-theme='dark']) .tip-card h3 {
    color: var(--text-dark);
  }

  :global([data-theme='dark']) .tip-info {
    background: rgba(255, 255, 255, 0.08);
  }

  :global([data-theme='dark']) .tip-info .kbd-hint {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-light);
  }

  /* Mobile Responsiveness */
  @media (max-width: 768px) {
    .carbon-dashboard {
      padding: 1.5rem;
    }

    .usage-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .carbon-summary {
      grid-template-columns: 1fr;
    }

    .breakdown-items {
      flex-direction: column;
    }

    .tech-grid {
      grid-template-columns: 1fr;
    }

    .tech-card {
      flex-direction: column;
      text-align: center;
    }

    .tech-icon {
      margin: 0 auto;
    }

    .tech-content {
      min-width: auto;
    }

    .tech-card .impact-badge {
      position: static;
      margin-top: 0.5rem;
    }

    .tips-grid {
      grid-template-columns: 1fr;
    }

    .cta-buttons {
      flex-direction: column;
      align-items: center;
    }

    .cta-buttons .btn {
      width: 100%;
      max-width: 280px;
    }
  }
</style>

<script>
  // Fetch carbon stats from static JSON
  async function loadCarbonStats() {
    const STATS_URL = '/data/carbon-stats.json';

    try {
      const response = await fetch(STATS_URL);
      if (!response.ok) throw new Error('Stats unavailable');

      const data = await response.json();

      // Format numbers for display
      const formatNumber = (num) => {
        if (num === null || num === undefined) return '—';
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
        return num.toLocaleString();
      };

      // Update usage stats
      const statCdnRequests = document.getElementById('stat-cdn-requests');
      const statPageViews = document.getElementById('stat-page-views');
      const statCiRuns = document.getElementById('stat-ci-runs');
      const statRenewable = document.getElementById('stat-renewable');

      if (statCdnRequests) statCdnRequests.textContent = formatNumber(data.usage.cdnRequests);
      if (statPageViews) statPageViews.textContent = formatNumber(data.usage.pageViews);
      if (statCiRuns) statCiRuns.textContent = formatNumber(data.usage.ciRuns);
      if (statRenewable) statRenewable.textContent = `${data.summary.renewableEnergyPercent}%`;

      // Update carbon summary
      const statGross = document.getElementById('stat-gross');
      const statNet = document.getElementById('stat-net');
      const statRating = document.getElementById('stat-rating');

      if (statGross) statGross.textContent = data.summary.totalGrossEmissionsKg;
      if (statNet) statNet.textContent = data.summary.netEmissionsKg;
      if (statRating) statRating.textContent = data.summary.greenRating;

      // Update emissions breakdown
      const breakdownCdn = document.getElementById('breakdown-cdn');
      const breakdownHosting = document.getElementById('breakdown-hosting');
      const breakdownCi = document.getElementById('breakdown-ci');

      if (breakdownCdn) breakdownCdn.textContent = `CDN: ${data.emissionsBySource.cdn.grams}g`;
      if (breakdownHosting)
        breakdownHosting.textContent = `Hosting: ${data.emissionsBySource.hosting.grams}g`;
      if (breakdownCi) breakdownCi.textContent = `CI/CD: ${data.emissionsBySource.ci.grams}g`;

      // Update data source indicators
      const sourceCloudflare = document.getElementById('source-cloudflare');
      const sourceGithub = document.getElementById('source-github');
      const sourceAzure = document.getElementById('source-azure');

      const getStatusClass = (status) => {
        if (status === 'live') return 'source-badge live';
        if (status === 'estimated') return 'source-badge estimated';
        return 'source-badge';
      };

      if (sourceCloudflare) {
        sourceCloudflare.textContent = `Cloudflare: ${data.dataFreshness.cloudflare}`;
        sourceCloudflare.className = getStatusClass(data.dataFreshness.cloudflare);
      }
      if (sourceGithub) {
        sourceGithub.textContent = `GitHub: ${data.dataFreshness.github}`;
        sourceGithub.className = getStatusClass(data.dataFreshness.github);
      }
      if (sourceAzure) {
        sourceAzure.textContent = `Azure: ${data.dataFreshness.azure || 'unavailable'}`;
        sourceAzure.className = getStatusClass(data.dataFreshness.azure);
      }

      // Update equivalents
      const statEquivalents = document.getElementById('stat-equivalents');
      if (statEquivalents) {
        statEquivalents.textContent = `Equivalent to driving ${data.comparison.equivalentMilesDriven} miles or printing ${data.comparison.equivalentPaperPages} pages—fully offset by renewable energy.`;
      }

      // Update status indicator
      const dashboardStatus = document.getElementById('dashboard-status');
      const anyLive = Object.values(data.dataFreshness).some((v) => v === 'live');
      if (dashboardStatus) {
        dashboardStatus.textContent = anyLive ? 'Live Data' : 'Estimated';
        dashboardStatus.className = anyLive
          ? 'dashboard-status live'
          : 'dashboard-status estimated';
      }
    } catch (error) {
      console.log('Using fallback carbon estimates:', error.message);
      // Show offline state
      const dashboardStatus = document.getElementById('dashboard-status');
      if (dashboardStatus) {
        dashboardStatus.textContent = 'Offline';
        dashboardStatus.className = 'dashboard-status offline';
      }
      const statEquivalents = document.getElementById('stat-equivalents');
      if (statEquivalents) {
        statEquivalents.textContent =
          'Using estimated data. According to provider reports, all infrastructure uses renewable energy.';
      }
    }
  }

  // Load stats when page is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadCarbonStats);
  } else {
    loadCarbonStats();
  }

  // Dark mode toggle functionality
  function initDarkModeToggle() {
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const darkModeLabel = document.getElementById('dark-mode-label');

    if (!darkModeToggle || !darkModeLabel) return;

    // Check current theme state
    const updateButtonState = () => {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      darkModeToggle.setAttribute('aria-pressed', isDark ? 'true' : 'false');
      darkModeLabel.textContent = isDark ? 'Disable Dark Mode' : 'Enable Dark Mode';
    };

    // Initialize state
    updateButtonState();

    // Toggle dark mode on click
    darkModeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);

      updateButtonState();
    });

    // Listen for theme changes from accessibility panel
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.attributeName === 'data-theme') {
          updateButtonState();
        }
      });
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-theme'],
    });
  }

  // Bookmark button functionality
  function initBookmarkButton() {
    const bookmarkBtn = document.getElementById('bookmark-btn');
    if (!bookmarkBtn) return;

    // Detect OS for keyboard hints
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    const shortcut = isMac ? '⌘D' : 'Ctrl+D';
    const closeShortcut = isMac ? '⌘W' : 'Ctrl+W';

    // Update keyboard hint in bookmark button
    const kbdHint = bookmarkBtn.querySelector('.kbd-hint');
    if (kbdHint) {
      kbdHint.textContent = shortcut;
    }

    // Update all kbd hints for close tabs tip
    document.querySelectorAll('.tip-info .kbd-hint').forEach((kbd) => {
      if (kbd.textContent === '⌘W') {
        kbd.textContent = closeShortcut;
      }
    });

    // Store original button text
    const buttonSpan = bookmarkBtn.querySelector('span:not(.kbd-hint)');
    const originalText = buttonSpan ? buttonSpan.textContent : 'Add Bookmark';

    bookmarkBtn.addEventListener('click', () => {
      // Show feedback with keyboard shortcut hint
      if (buttonSpan) {
        buttonSpan.textContent = `Press ${shortcut}`;
      }
      bookmarkBtn.style.background = 'var(--primary-blue)';

      // Fill the bookmark icon to indicate "activated"
      const svg = bookmarkBtn.querySelector('svg');
      if (svg) {
        svg.setAttribute('fill', 'currentColor');
      }

      setTimeout(() => {
        if (buttonSpan) {
          buttonSpan.textContent = originalText;
        }
        bookmarkBtn.style.background = '';
        if (svg) {
          svg.setAttribute('fill', 'none');
        }
      }, 3000);
    });
  }

  // Initialize tip buttons when ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      initDarkModeToggle();
      initBookmarkButton();
    });
  } else {
    initDarkModeToggle();
    initBookmarkButton();
  }
</script>
